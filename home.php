<?php

require_once 'components/games.php';

// Sets the dark mode cookie if does not exist
$name = "dark";
if (!isset($_COOKIE[$name]))
  setcookie($name, "false", strtotime('Thu, 18 Dec 2030 12:00:00'), "/PatingGames");
?>


<!DOCTYPE html>

<head>
  <meta name="Viewport" content="width=device-width, initial-scale=1">
  <title>Home | PatingGames</title>
  <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="assets/css/homepage.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="script.js" defer></script>

</head>

<body>
  <?php require 'components/header.php' ?>
  <main>
    <section>
      <div>
        <h3>Welcome to</h3>
        <h1>PatingGames</h1>
        <p>We, The Team Pating are passionate about bringing fun and interactive gaming experiences to your browser using the power of HTML, CSS, and PHP. Whether you're a casual gamer or a seasoned pro, there's something here for everyone. Join us on this gaming journey!</p>
        <a href="#categories">Browse now!</a>
      </div>
      <svg class="logo" width="250" height="250" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800">
        <path class="st0" d="M219.1,202.5C127.9,244.7,62.1,310.7,62.7,326.7c0.3,8.3,4.5,23.2,16.6,35.9c7.1,7.5,26,21.2,39.3,22
	c13.2,0.8,108.8-62.9,108.8-62.9l95.2-13.2l57.9,138.2c0,0,19,27.3,45.5,49.7s52.1,29.8,57.9,24.8c5.8-5-11.2-38.5-12.4-47.1
	c-1.6-11.5-6.6-39.7,21.5-35.6c28.2,4.2,80.3,24.8,80.3,55.4s-20.7,64.5-79.4,64.5s-141.5-19-179.6-17.4s-72,4.9-106.7,19
	c-25.7,10.4-54.6,29.8-53.8,32.3c0.8,2.5,33.1,13.2,71.2,18.2c38.1,5,111.7,4.1,124.1,22.3c12.4,18.2,15.7,44.4,11.6,83.3
	c-4.1,38.9-2.5,70.6-1.6,70.6c0.8,0,33.3-18.6,49.7-47.1c26.5-46.3,26.5-102.6,36.4-114.2c9.9-11.6,51.1-14.8,84.4-19
	c34.2-4.4,228.4-12.4,228.4-206c0-155.6-148.1-190.3-151.4-193.6c-3.3-3.3-8.7-27.6,2.5-49.7c8.8-17.4,23.7-43.9,19-50.5
	c-5.8-8.2-59.6,0.8-99.3,21.5S464,175.2,464,175.2S311.4,159.9,219.1,202.5L219.1,202.5z" />
        <path class="st1" d="M242.3,285.2c30.2-13.3,79.5-24.2,116.7-26.5c66.6-4.1,123.3,3.7,123.3,3.7s24.2,50.5,43.9,75.7
	c34.3,44.1,83.8,78.2,90.4,68.7c5.5-7.9,1.1-49.7-7.6-75.3c-4.3-12.6-18.2-46.3-18.2-46.3s60.4,4.9,95.2,54.6
	c34.7,49.7,48.8,154.8-27.3,199.4C592.3,578.2,555,572.4,555,572.4s39.7-43.9,33.4-74.8c-6.6-32.6-21-41.4-45.8-46.1
	c-15.7-2.9-150.4,0-185.9-0.8s-89.1-3.3-126.1-14.6c-17.7-5.4-30.3-13.8-30.3-13.8l0.8-29.8c0,0-30.3,6.1-47.7,4.4
	c-17.4-1.6-41.9-11.6-43.6-14s19.6-21,37.3-34.7C169.2,331,206.7,301,242.3,285.2L242.3,285.2z" />
        <path class="st2" d="M317.6,326.9c0,8.4-9.9,8-18.5,8c-8.5,0-14,0.5-17.9,3.3c-3.9,2.8-1.1,22-36.4,54.1c-21,19-40.9,31.7-44.1,30.6
	s-9.6-17.4-11.1-23.5c-14,4.1-45.7-2.2-40.9-3.3c16.3-3.9,40.6-15,56.8-27.3c11.3-8.5,33-25.6,39.7-30.1
	c5.8-3.9,22.6-16.3,30.1-17.1C287.5,320.3,317.6,317.8,317.6,326.9L317.6,326.9z" />
        <path class="st3" d="M271.2,280.8c0,13.7-12.7,25.4-28.4,23.7c-13.5-1.4-24.6-11.1-24.6-24.8c0-13.7,10.7-26,24.3-26.5
	C264.4,252.6,271.2,267.1,271.2,280.8z" />
        <path class="st4" d="M211.6,384.8c5.2-4.4-5.2-16.6-5.2-16.6l-12.7,8.4C193.7,376.7,204.5,390.9,211.6,384.8z" />
        <path class="st4" d="M242,362.5c5.2-4.4-5.5-17.6-5.5-17.6l-13.5,10.5C223,355.3,234.8,368.5,242,362.5L242,362.5z" />
        <path class="st4" d="M255.8,355.1c-4.5,5.2,8.3,17.1,8.3,17.1s10.6-14,9.4-14.9C272.4,356.4,261.8,348,255.8,355.1z" />
        <path class="st4" d="M232.9,377.9c-4.5,5.2,5.8,18.8,7.6,18.2s11.7-11.1,11.7-11.1S238.9,370.8,232.9,377.9L232.9,377.9z" />
        <path class="st5" d="M421.3,218.2c-6.6,4.4-2.2,13.8,1.6,21.5c3.9,7.7,6.3,14.8,6.8,25.2c0.4,9.4-2.1,26.3-3.2,32.2
	c-1,5.3-4.6,17,3.3,19c9.9,2.5,12.7-5.2,14.9-12.7c2.9-9.7,4.3-29.4,3.9-39.4c-1.1-21.4-8.3-34.2-11.6-39.1
	C433.7,219.9,427.8,213.9,421.3,218.2L421.3,218.2z" />
        <path class="st5" d="M469.6,231.4c-4.4,3.5,0,14,1.9,18.8c1.9,4.7,2.9,11.3,2.9,18c0,4.7-0.9,15.6-1.5,21.6
	c-0.8,9.1-0.4,14.5,6.3,15.7c10.5,1.9,10.9-12.1,11.9-17.9c0.8-4.6,1.5-19.9,0.9-27.1c-0.5-7.2-3.9-17.6-8.1-23.9
	C480.6,231.6,475.1,227,469.6,231.4L469.6,231.4z" />
        <path class="st5" d="M377.2,214.1c-9.1,4.6,0.8,20.2,3.3,25.4c2.5,5.2,6.1,16.8,5.8,29c-0.3,12.1-1.2,24.6-3.3,31.3
    c-1.8,5.9-7.2,15.9-3.1,20c6.1,6.1,15.8-0.2,19.2-10.1c4.9-14.5,6.2-26.3,5.6-45.1C404,239.4,390.7,207.2,377.2,214.1z" />
        <path class="st4" d="M208,399.7c-4.5,5.2,5.2,17.4,5.2,17.4l13.5-9.4C226.8,407.7,214.1,392.6,208,399.7L208,399.7z" />
        <path class="st4" d="M266.5,341c5.1-4.6-3.6-14.3-3.6-14.3s-12.4,7.5-11.9,8.3C252.3,336.7,261,346,266.5,341z" />
        <g>
          <path class="svg" d="M147.5,218c-10.8-28.3-14.1-36.2-44-70.4c-40.6-46.4,16-60.2,16-60.2s-0.6,4.6,1.8,9.1c0,0,3.2-13.9,17.4-20.8
		c14.8-7.2,34.1,2.7,43.8,17.7c30.7,47.5-23.4,65.7-23.4,65.7s22.8,31.2,25.3,41.2C187.1,210.9,153.9,234.9,147.5,218z M140.4,134.5
		l4.7-8.7c0,0,5.6,7.9,10.2,4.3c12.1-9.4-7.4-23.2-15.4-11.7C134.3,126.5,140.4,134.5,140.4,134.5z" />
          <path class="svg" d="M218.3,173.8c-2-5.5-13.4-84.6-14.8-94.3c-7.7-52.8,53.3-51.1,53.3-51.1s-2.8,10.2,2.4,20.7c4.8,9.5,47.8,74.7,51.5,90.7
		c2,8.7-27.5,24.2-34,20.3c-9.1-5.5-22.8-46-25.7-43.8c-3.3,2.5,11.4,41.2,9.4,48.3C258.2,172.4,221.5,182.6,218.3,173.8z
		 M228.6,87.1l6.4-7.5c0,0,3.8,8.9,9,6.4c13.8-6.6-2.3-24.3-12.6-14.8C224.4,77.9,228.6,87.1,228.6,87.1z" />
          <path class="svg" d="M395.2,44.8c0,0-14.2-8.5-30.7-4.4c-2.2,0.6-4.8,1.2-7.6,1.9c0,0,18.9,88.5,16.5,95.3c-2.9,8.3-37.1,14.3-41.5,5.3
		c-3.2-6.6-8.4-93.6-8.4-93.6c-13.7,2.5-22.3,3.2-29.3,1.6c-8.2-1.9-15.5-39.5-1.4-38.1c23.5,2.3,30.9,1.6,64.8-8.3
		C403.7-9.1,395.2,44.8,395.2,44.8z" />
          <path class="svg" d="M402.2,137.1c0,0,13.7-11,13.5-27.7c-0.2-13.7,1-66.5,0.6-73.5c-3-47.1,56.8-24.4,56.8-24.4s-13.7,11-13.5,27.7
		c0.2,13.6-1,66.4-0.6,73.5C462,159.8,402.2,137.1,402.2,137.1z" />
          <path class="svg" d="M491.4,148c-14.4,1.2-30.8-9.6-30.8-9.6s20.3-46.3,23.2-58.1c2.9-11.8,13.2-64.2,13.2-64.2s21.9-4,35.4,4.1
		c17.3,10.3,9.9,44,11.6,57.5c1.8,13.5,5.1,18.8,5.1,18.8s-1.7-41.1,5.6-55.1c4.1-7.8,11.1-14.5,23.9-9.6c12.8,5,18.4,9.6,18.4,9.6
		s-8.9,10.1-13,27.3c-4,17.2-14.5,69.6-16.9,78.4c-3.2,11.8-10.4,21.5-28.9,16.3c-21.3-6-23.8-13.8-23.8-13.8s5.7-12.6,7.6-27.1
		c2.3-17.1-3.5-36.8-3.5-36.8S522.9,145.4,491.4,148z" />
          <path class="svg" d="M588.4,116.5c16.8-32.3,43.4-49.2,65.1-47.6c31.1,2.3,58.3,34.9,48.1,52.6c-15.1,26.3-44.9,3.3-44.9,3.3s13.7-9.9,6.6-12.8
		s-19.4,3.2-27.7,15.7c-7.9,11.8-19.3,38.9-12.2,42.3c2.6,1.2,5.9,5.2,9.8,0.2c2.9-3.7,4.8-5.9-1.7-10.3c-6.6-4.6,3.7-24,13.4-24.6
		c4.3-0.3,17.4,7.2,23.4,11.3c6.9,4.7,13.3,9.3,5.4,22.8c-22.7,38.9-28.5,55.2-76.1,22.9C566.6,171.2,571.6,148.8,588.4,116.5z" />
        </g>
        <g>
          <path class="svg" d="M128,663.7c14.1-33.6,39.1-52.6,60.9-52.8c31.2-0.3,61,29.9,52.3,48.4c-12.9,27.4-44.5,7.1-44.5,7.1s12.8-11,5.5-13.3
		c-7.3-2.2-19.1,4.9-26.3,17.9c-6.9,12.4-16,40.4-8.6,43.2c2.7,1,6.3,4.7,9.8-0.6c2.5-3.9,4.3-6.3-2.6-10.2c-7-4,1.7-24.2,11.3-25.7
		c4.2-0.6,17.9,5.7,24.2,9.3c7.3,4.1,14,8.2,7.3,22.2c-19.4,40.6-23.8,57.4-73.9,29.1C110.8,720,113.9,697.3,128,663.7z" />
          <path class="svg" d="M315.6,759.5c-4.1,10.7-3.8,31.2-3.8,31.2s-34.1,1.5-32-15c0,0-9.8,8.7-30.7,0.1c-15.5-6.4-24.4-19.4-14.8-46.2
		c6.1-17,19.4-26.8,38.8-23.5c12.8,2.1,21.6,9.5,23.5,12c0.4-2.2,4.7-13.2-13.1-19.3c-14.2-4.8-33.1,4-33.1,4s-6.8-32.8,19.7-31.8
		c14.3,0.6,54.1,4.3,59.6,30c1.8,8.4,0.5,12.9-2.4,23.9C325.2,735.4,320,747.8,315.6,759.5z M284,740.9l-9.1,2.9
		c0,0,1.7-9.5-3.8-10.2c-14.7-1.8-11.1,21.8,2.3,19.2C282.6,751,284,740.9,284,740.9z" />
          <path class="svg" d="M493.7,783.8c0,0-33.7,20.6-42.5,0.8c-4.1-9.2,0.7-57.3-3.8-60.9c-4.7-3.9-9.1-1.3-9.2,2.6c-0.2,3.9,3.9,50.8,1.4,60.7
		c-2.6,10.4-45.5,14.7-39.8-2.3c5-14.6,3.7-57.2,0.5-59.8c-4.7-3.9-9.1-1.3-9.2,2.6c-0.2,3.9,3.9,50.8,1.4,60.7
		c-2.6,10.4-43.2,15.4-39.8-2.3c4.2-21.5,1.8-35.1-1.9-60.6c-6.3-44.6,25.5-36.7,25.5-36.7s-4.3,3-0.5,7.1c0,0,7.5-8.5,24.5-9.1
		c14.4-0.5,16.5,4.9,19.7,10.1c4-6.6,8.5-11.8,25-12.2c23.1-0.6,39.2,8.8,41,60.4C487.2,781.3,493.7,783.8,493.7,783.8z" />
          <path class="svg" d="M552.4,725.8c3.1,5.1,10.2,8.2,21.2,5.2c9.5-2.5,23.1-17.1,23.1-17.1s22.9,21.3,4.1,38.8c-7.1,6.6-20.5,12.5-39.7,15.4
		c-25,3.9-42.7-19.4-48.1-38.1c-5.3-18.7-8.7-56.6,29.4-69.6c39.2-13.3,53.2,21.8,53.2,32.2C595.6,727.7,551.9,725,552.4,725.8z
		 M549.7,713.9l5.3-5.9c0,0,2.9,7.4,7.1,5.5c11.2-5-1.5-20-9.8-12.5C546.4,706.2,549.7,713.9,549.7,713.9z" />
          <path class="svg" d="M697.9,655.5c32.5,47.5-38,77.1-59.8,72.7c-6.3-1.3-10.2-35-4-36.3c9.3-1.9,33.7-1.3,31.6-6.4c-2.5-6.3-30.4,2.7-41.8-0.8
		c-13.8-4.3-21.7-23.3-18.6-38.7c3.3-16.8,27.3-30.7,40.5-34.5c48.1-13.7,24.7,29.9,24.7,29.9s-6.8-6.3-18.1-1.8c0,0-11,4.6-7.6,7.5
		C647.4,649.3,686.4,638.7,697.9,655.5z" />
        </g>
      </svg>
    </section>
    <h4 class="featured title">Featured</h4>
    <ul id="featured" role="list">
      <?php
      $conn = new mysqli($GLOBALS['servername'], $GLOBALS['username'], null, "games");

      if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
      }

      searchGames($conn, null, 'featured');

      $conn->close();
      ?>
    </ul>
    <h4 class="title">Browse by category</h4>
    <ul id="categories" role="list">
      <li>
        <form class="all" method="post">
          <img src='assets/img/categories/all.svg' alt='Category Icon'>
          <input type="submit" name="all" value="All">
        </form>
      </li>
      <?php
      // For echoing the category buttons
      $buttons = array("action", "arcade", "adventure", "casual", "puzzle", "racing", "shooter", "simulation", "sports", "strategy");

      foreach ($buttons as $name) {
        echo "<li><form class='{$name}' action='home.php#categories' method='post'><img src='assets/img/categories/{$name}.svg' alt='Category Icon'><input type='submit' name='category' value=" . ucfirst($name) . "></input></form></li>";
      }
      ?>
      <li>
    </ul>
    <ul id="list" role="list">
      <?php
      $dbname = "games";
      $conn = new mysqli($GLOBALS['servername'], $GLOBALS['username'], null, $dbname);

      if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
      }

      // For clicking the clear button
      if (isset($_POST['all'])) {
        loadGames($conn);
      }

      // For clicking from the categories
      if (isset($_POST['category'])) {
        searchGames($conn, 'category', lcfirst($_POST['category']));
      }

      // Searching at the search bar
      if ($_SERVER["REQUEST_METHOD"] == "GET") {
        if (isset($_GET['search'])) {
          $query = htmlentities($_GET['search']);
          searchGames($conn, 'search', $query);
        } else loadGames($conn);
      }

      function loadGames($conn)
      {
        $query = "SELECT title, descp, tags, thumbnail FROM game";
        $result = mysqli_query($conn, $query);

        if ($result->num_rows > 0) {
          while ($row = $result->fetch_object()) {
            renderGames($row);
          }
        }
      }

      function searchGames($conn, $cate, $tag)
      {
        if ($cate == 'category') {
          $query = "SELECT title, descp, tags FROM game
          WHERE '$tag' IN (tags)";
        } else {
          $query = "SELECT title, descp, tags FROM game
          WHERE tags LIKE '%$tag%'";
        }

        $result = mysqli_query($conn, $query);

        if ($result->num_rows > 0) {
          while ($row = $result->fetch_object()) {
            renderGames($row);
          }
        }
      }

      function renderGames($game)
      {
        echo "<li class='card'>
          <div class='thumbnail'>
              <img src={$game->thumbnail} alt='Game Thumbnail'>
          </div>
          <div class='info'>
            <h4>{$game->title}</h4>
            <p>{$game->descp}</p>
            <form action='game.php' method='get'>
                <button name='PlayButton' value='{$game->title}' type='submit'>PLAY</button>
            </form>
          </div>
        </li>";
      }

      $conn->close();
      ?>
      <a class="backtop" href="#"><img src="./assets/img/icons/top.svg" alt="Back to Top"></a>
  </main>
  <?php require 'components/footer.php' ?>
</body>

</html>